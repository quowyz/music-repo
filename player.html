<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¶éœ²æ¹˜é›¨çš„éŸ³ä¹ä»“åº“</title>
<style>
  :root{
    --accent1: #ff6a00;
    --accent2: #ee0979;
    --glass: rgba(255,255,255,0.08);
    --text-light: #f3f3f3;
  }
  *{box-sizing:border-box}
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--text-light);
    margin: 0;
  }

  header{
    text-align:center;
    padding:18px 12px;
  }
  header h1{
    margin:0;
    font-size:1.5rem;
    font-weight:700;
  }

  .player-container{
    max-width:1100px;
    margin:24px auto;
    display:flex;
    flex-direction:column;
    gap:18px;
  }
  @media(min-width:900px){
    .player-container{
      flex-direction:row;
      align-items:flex-start;
      gap:28px;
    }
  }

  /* å·¦ä¾§å°é¢å’Œæ§åˆ¶åŒº */
  .left { flex: 1 1 540px; min-width: 260px; }
  .cover-card{
    background: var(--glass);
    border-radius:20px;
    padding:16px;
    box-shadow: 0 12px 36px rgba(0,0,0,0.35);
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .cover {
    width:100%; max-width:420px; max-height:420px;
    border-radius:16px;
    object-fit:cover;
    transition: opacity .6s ease, transform .3s ease;
  }
  .cover:hover { transform: scale(1.03); }

  .song-title { margin:12px 0 6px; font-size:1.4rem; font-weight:700; text-align:center; }
  .meta-row{ display:flex; justify-content:space-between; align-items:center; width:100%; font-size:0.9rem; margin-bottom:12px; }

  /* æ§åˆ¶æŒ‰é’® */
  .controls{
    margin-top:8px;
    display:flex; gap:24px; justify-content:center; align-items:center;
  }
  .btn-symbol {
    font-size: 28px;
    background: transparent;
    border: none;
    color: var(--text-light);
    cursor: pointer;
    padding: 8px;
    transition: transform 0.2s, color 0.2s;
  }
  .btn-symbol:hover {
    transform: scale(1.3);
    color: #ffcc00;
  }
  .btn-symbol:active {
    transform: scale(1.1);
  }

  /* æ’­æ”¾åˆ—è¡¨ */
  .right{
    width:360px; flex:0 0 360px; display:flex; flex-direction:column; gap:12px;
  }
  @media(max-width:899px){ .right{ width:100%; order:2; } .left{ order:1; } }
  .playlist{
    background: var(--glass); padding:16px; border-radius:20px;
    max-height:520px; overflow:auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }
  .playlist h3{ margin:6px 8px; font-size:1.1rem; }
  .playlist ul{
    list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px;
  }
  .playlist li{
    padding:8px; border-radius:12px; cursor:pointer;
    display:flex; align-items:center; gap:12px;
    font-size:0.95rem;
    transition: transform 0.2s, background 0.2s;
  }
  .playlist li:hover { transform: scale(1.02); }
  .playlist li.active{ background: linear-gradient(135deg,var(--accent1),var(--accent2)); font-weight:700; }
  .playlist .thumb{ width:50px;height:50px;border-radius:8px;object-fit:cover; }

</style>
</head>
<body>

<header><h1>ğŸµ å¶éœ²æ¹˜é›¨çš„éŸ³ä¹ä»“åº“</h1></header>

<div class="player-container">
  <div class="left">
    <div class="cover-card">
      <img id="cover" class="cover" src="" alt="å°é¢" />
      <div class="song-title" id="title">--</div>
      <div class="meta-row">
        <div id="artist"></div>
        <div id="playCount">æ’­æ”¾é‡: 0</div>
      </div>
      <div class="controls">
        <button id="prev" class="btn-symbol">â®</button>
        <button id="playPause" class="btn-symbol">â–¶ï¸</button>
        <button id="next" class="btn-symbol">â­</button>
        <button id="mode" class="btn-symbol">ğŸ”</button>
      </div>
      <audio id="audio" preload="auto"></audio>
    </div>
  </div>

  <div class="right">
    <div class="playlist">
      <h3>æ’­æ”¾åˆ—è¡¨</h3>
      <ul id="songList"></ul>
    </div>
  </div>
</div>

<script>
let musicFiles = [];
const audio = document.getElementById('audio');
const cover = document.getElementById('cover');
const title = document.getElementById('title');
const playCountDiv = document.getElementById('playCount');
const playPauseBtn = document.getElementById('playPause');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const modeBtn = document.getElementById('mode');
const songList = document.getElementById('songList');

let currentIndex = 0;
let mode = "loop"; // loop | random
const audioCache = {};

// æ ¼å¼åŒ–æ—¶é—´
function formatTime(sec){
  if(!sec) return "0:00";
  const m=Math.floor(sec/60),s=Math.floor(sec%60);
  return `${m}:${s.toString().padStart(2,'0')}`;
}

// æ¸²æŸ“æ’­æ”¾åˆ—è¡¨
function updatePlaylist(){
  songList.innerHTML = '';
  musicFiles.forEach((s,i)=>{
    const li=document.createElement('li');
    li.className = (i===currentIndex)?'active':'';
    li.innerHTML=`<img class="thumb" src="${s.image}"> <span>${s.name}</span>`;
    li.onclick=()=>loadSong(i,true);
    li.onmouseover=()=>preloadSong(i);
    songList.appendChild(li);
  });
}

// åŠ è½½æ­Œæ›²
function loadSong(index, autoplay=false){
  currentIndex=index;
  const s=musicFiles[index];
  audio.src=s.audio;
  cover.style.opacity=0;
  setTimeout(()=>{ cover.src=s.image; cover.style.opacity=1; },200);
  title.textContent=s.name;
  playCountDiv.textContent=`æ’­æ”¾é‡: ${s.playCount}`;
  updatePlaylist();
  if(autoplay) playSong();
}

// æ’­æ”¾æ§åˆ¶
function playSong(){ audio.play(); playPauseBtn.textContent='â¸'; }
function pauseSong(){ audio.pause(); playPauseBtn.textContent='â–¶ï¸'; }
function prevSong(){ playSongAt(mode==="random"?Math.floor(Math.random()*musicFiles.length):(currentIndex-1+musicFiles.length)%musicFiles.length); }
function nextSong(){ playSongAt(mode==="random"?Math.floor(Math.random()*musicFiles.length):(currentIndex+1)%musicFiles.length); }
function playSongAt(i){ loadSong(i,true); }

playPauseBtn.onclick=()=> audio.paused?playSong():pauseSong();
prevBtn.onclick=prevSong; nextBtn.onclick=nextSong;
modeBtn.onclick=()=>{
  mode = (mode==="loop")?"random":"loop";
  modeBtn.textContent = mode==="loop"?"ğŸ”":"ğŸ”€";
};

// æ—¶é—´ä¸è¿›åº¦æ¡
audio.onloadedmetadata=()=>{ };
audio.ontimeupdate=()=>{ };
audio.onplay=()=>{
  musicFiles[currentIndex].playCount++;
  playCountDiv.textContent=`æ’­æ”¾é‡: ${musicFiles[currentIndex].playCount}`;
};

// é¢„åŠ è½½
function preloadSong(index){
  const s = musicFiles[index];
  if(!audioCache[index]){
    const a = new Audio(s.audio);
    a.preload="auto";
    audioCache[index]=a;
  }
}

// ä» JSON åŠ è½½æ­Œæ›²
fetch('music-list.json')
  .then(res=>res.json())
  .then(data=>{
    musicFiles = data.map(s=>({...s, playCount:0}));
    updatePlaylist();
    loadSong(0,false);
  })
  .catch(err=>console.error("åŠ è½½æ­Œæ›²åˆ—è¡¨å¤±è´¥",err));

</script>
</body>
</html>
