<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>叶露湘雨的音乐仓库</title>
<style>
  :root{
    --accent1: #ff6a00;
    --accent2: #ee0979;
    --glass: rgba(255,255,255,0.08);
    --text-light: #f3f3f3;
  }
  *{box-sizing:border-box}
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--text-light);
    margin: 0;
  }

  header{
    text-align:center;
    padding:18px 12px;
  }
  header h1{
    margin:0;
    font-size:1.5rem;
    font-weight:700;
  }

  .player-container{
    max-width:1100px;
    margin:24px auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:18px;
  }
  @media(min-width:900px){
    .player-container{
      flex-direction:row;
      align-items:flex-start;
      gap:28px;
    }
  }

  /* 左侧封面区域 */
  .left { flex: 1 1 540px; min-width: 260px; display:flex; flex-direction:column; align-items:center; }
  .cover-card {
    background: var(--glass);
    padding:12px;
    border-radius:18px;
    box-shadow: 0 14px 40px rgba(0,0,0,0.35);
    display:flex; flex-direction:column; align-items:center;
    transition: transform 0.3s;
  }
  .cover-card:hover { transform: scale(1.02); }

  .cover {
    width:100%; max-width:400px; max-height:400px;
    border-radius:16px;
    object-fit:cover;
    transition: opacity .6s ease, transform .3s ease;
  }

  .song-title { margin:12px 0 6px; font-size:1.3rem; font-weight:700; text-align:center; }
  .meta-row{ display:flex; justify-content:space-between; width:100%; font-size:0.95rem; }
  .play-count{ opacity:0.9; }

  .progress-wrap{ margin-top:12px; width:100%; }
  .time-row{ display:flex; justify-content:space-between; font-size:0.85rem; }

  input[type=range].progress{
    -webkit-appearance:none; width:100%; height:8px;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    border-radius:6px; outline:none; margin:6px 0 0;
  }
  input[type=range].progress::-webkit-slider-thumb{
    -webkit-appearance:none; width:16px; height:16px;
    border-radius:50%; background:#fff;
    border:3px solid rgba(255,255,255,0.25);
  }

  /* 控制按钮风格 */
  .controls{
    margin-top:16px;
    display:flex; gap:24px; justify-content:center; align-items:center;
  }
  .btn-symbol {
    font-size: 28px;
    background: transparent;
    border: none;
    color: var(--text-light);
    cursor: pointer;
    padding: 8px;
    transition: transform 0.2s, color 0.2s;
  }
  .btn-symbol:hover { transform: scale(1.3); color: #ffcc00; }
  .btn-symbol:active { transform: scale(1.1); }

  /* 右侧播放列表 */
  .right{ width:360px; flex:0 0 360px; display:flex; flex-direction:column; gap:12px; }
  @media(max-width:899px){ .right{ width:100%; order:2; } .left{ order:1; } }

  .playlist-card{
    background: var(--glass);
    padding:12px;
    border-radius:18px;
    box-shadow: 0 14px 40px rgba(0,0,0,0.35);
    max-height:420px;
    overflow:auto;
  }
  .playlist-card h3{ margin:6px 8px; font-size:1rem; }
  .playlist-card ul{
    display:grid; grid-template-columns:repeat(2,1fr); gap:10px;
    list-style:none; padding:0; margin:0;
  }
  .playlist-card li{
    padding:8px; border-radius:12px; cursor:pointer;
    display:flex; align-items:center; gap:8px;
    font-size:0.95rem;
    transition: transform 0.2s, background 0.2s;
  }
  .playlist-card li:hover { transform: scale(1.02); }
  .playlist-card li.active{ background: linear-gradient(135deg,var(--accent1),var(--accent2)); font-weight:700; }
  .playlist-card .thumb{ width:50px;height:50px;border-radius:8px;object-fit:cover; }
</style>
</head>
<body>

<header><h1>🎵 叶露湘雨的音乐仓库</h1></header>

<div class="player-container">
  <div class="left">
    <div class="cover-card">
      <img id="cover" class="cover" src="" alt="封面" />
      <div class="song-title" id="title">--</div>
      <div class="meta-row">
        <div id="artist"></div>
        <div id="playCount" class="play-count">播放量: 0</div>
      </div>
      <div class="progress-wrap">
        <div class="time-row"><span id="currentTime">0:00</span><span id="duration">0:00</span></div>
        <input id="progress" class="progress" type="range" min="0" max="100" value="0" />
      </div>
      <div class="controls">
        <button id="prev" class="btn-symbol">⏮</button>
        <button id="playPause" class="btn-symbol">▶️</button>
        <button id="next" class="btn-symbol">⏭</button>
        <button id="mode" class="btn-symbol">🔁</button>
      </div>
      <audio id="audio"></audio>
    </div>
  </div>

  <div class="right">
    <div class="playlist-card">
      <h3>播放列表</h3>
      <ul id="songList"></ul>
    </div>
  </div>
</div>

<script>
// 从本地 JSON 文件读取歌曲列表
let musicFiles = [];

fetch('music-list.json')
  .then(res => res.json())
  .then(data => {
    musicFiles = data;
    updatePlaylist();
    loadSong(0,false);
  })
  .catch(err => console.error("加载歌曲列表失败:", err));

const audio = document.getElementById('audio');
const cover = document.getElementById('cover');
const title = document.getElementById('title');
const playCountDiv = document.getElementById('playCount');
const playPauseBtn = document.getElementById('playPause');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const modeBtn = document.getElementById('mode');
const songList = document.getElementById('songList');
const progress = document.getElementById('progress');
const currentTimeEl = document.getElementById('currentTime');
const durationEl = document.getElementById('duration');

let currentIndex = 0;
let mode = "loop"; // loop | random

function updatePlaylist(){
  songList.innerHTML = '';
  musicFiles.forEach((s,i)=>{
    const li=document.createElement('li');
    li.className = (i===currentIndex)?'active':'';
    li.innerHTML=`<img class="thumb" src="${s.image}"> <span>${s.name}</span>`;

    // 鼠标悬停预加载
    li.onmouseenter = () => {
      const preAudio = new Audio(s.audio);
      preAudio.preload = 'auto';
    };

    li.onclick = () => loadSong(i,true);
    songList.appendChild(li);
  });
}

function formatTime(sec){
  if(!sec) return "0:00";
  const m=Math.floor(sec/60),s=Math.floor(sec%60);
  return `${m}:${s.toString().padStart(2,'0')}`;
}

function loadSong(index, autoplay=false){
  currentIndex=index;
  const s=musicFiles[index];
  audio.src=s.audio;
  cover.style.opacity=0;
  setTimeout(()=>{ cover.src=s.image; cover.style.opacity=1; },200);
  title.textContent=s.name;
  playCountDiv.textContent=`播放量: ${s.playCount}`;
  updatePlaylist();
  if(autoplay) playSong();
}

function playSong(){ audio.play(); playPauseBtn.textContent='⏸'; }
function pauseSong(){ audio.pause(); playPauseBtn.textContent='▶️'; }
function prevSong(){ playSongAt(mode==="random"?Math.floor(Math.random()*musicFiles.length):(currentIndex-1+musicFiles.length)%musicFiles.length); }
function nextSong(){ playSongAt(mode==="random"?Math.floor(Math.random()*musicFiles.length):(currentIndex+1)%musicFiles.length); }
function playSongAt(i){ loadSong(i,true); }

playPauseBtn.onclick=()=> audio.paused?playSong():pauseSong();
prevBtn.onclick=prevSong; nextBtn.onclick=nextSong;
modeBtn.onclick=()=>{
  mode = (mode==="loop")?"random":"loop";
  modeBtn.textContent = mode==="loop"?"🔁":"🔀";
};

audio.onloadedmetadata=()=> durationEl.textContent=formatTime(audio.duration);
audio.ontimeupdate=()=>{ progress.value=(audio.currentTime/audio.duration)*100; currentTimeEl.textContent=formatTime(audio.currentTime); };
progress.oninput=()=> audio.currentTime=(progress.value/100)*audio.duration;

audio.onplay=()=>{
  musicFiles[currentIndex].playCount++;
  playCountDiv.textContent=`播放量: ${musicFiles[currentIndex].playCount}`;
};
audio.onended=nextSong;
</script>
</body>
</html>
