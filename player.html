<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>我的音乐播放器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: #f4f4f9;
    }
    .player {
      max-width: 400px;
      margin: auto;
      background: white;
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    img {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      object-fit: cover;
      transition: opacity 0.6s ease-in-out; /* 淡入淡出 */
    }
    .controls {
      margin: 15px 0;
    }
    .controls button {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      border: none;
      color: white;
      padding: 10px 18px;
      margin: 5px;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .controls button:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .playlist {
      display: grid;
      grid-template-columns: 1fr 1fr; /* 两栏布局 */
      gap: 8px;
      margin-top: 10px;
    }
    .playlist div {
      background: #f9f9f9;
      padding: 6px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .playlist div:hover {
      background: #e6f0ff;
    }
    .active {
      background: #cce0ff !important;
      font-weight: bold;
    }
    .mode {
      margin-top: 10px;
      font-size: 14px;
      color: #444;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>🎶 我的音乐播放器 🎶</h2>
  <div class="player">
    <img id="cover" src="images/1.jpg" alt="封面">
    <div class="controls">
      <button onclick="prevSong()">⏮ 上一首</button>
      <button onclick="togglePlay()">▶️/⏸ 播放</button>
      <button onclick="nextSong()">⏭ 下一首</button>
    </div>
    <div id="mode" class="mode" onclick="switchMode()">🔁 循环播放</div>
    <div class="playlist" id="playlist"></div>
  </div>

  <audio id="audio" preload="auto"></audio>

  <script>
    const songs = [
      { title: "歌曲 1", src: "music/1.mp3", cover: "images/1.jpg" },
      { title: "歌曲 2", src: "music/2.mp3", cover: "images/2.jpg" },
      { title: "歌曲 3", src: "music/3.mp3", cover: "images/3.jpg" },
      { title: "歌曲 4", src: "music/4.mp3", cover: "images/4.jpg" },
    ];

    let currentIndex = 0;
    let mode = "loop"; // loop / random
    const audio = document.getElementById("audio");
    const cover = document.getElementById("cover");
    const playlistEl = document.getElementById("playlist");

    // 渲染播放列表
    function renderPlaylist() {
      playlistEl.innerHTML = "";
      songs.forEach((song, i) => {
        const div = document.createElement("div");
        div.textContent = song.title;
        div.className = (i === currentIndex) ? "active" : "";
        div.onclick = () => playSong(i);
        playlistEl.appendChild(div);
      });
    }

    // 切换歌曲并淡入淡出
    function playSong(index) {
      currentIndex = index;
      const song = songs[currentIndex];
      audio.src = song.src;

      // 封面淡出再换图
      cover.style.opacity = 0;
      setTimeout(() => {
        cover.src = song.cover;
        cover.style.opacity = 1;
      }, 300);

      audio.play();
      renderPlaylist();

      // 上传播放量
      fetch(`https://api.countapi.xyz/hit/my-music-player/${encodeURIComponent(song.title)}`);
    }

    function togglePlay() {
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
    }

    function prevSong() {
      if (mode === "random") {
        playSong(Math.floor(Math.random() * songs.length));
      } else {
        playSong((currentIndex - 1 + songs.length) % songs.length);
      }
    }

    function nextSong() {
      if (mode === "random") {
        playSong(Math.floor(Math.random() * songs.length));
      } else {
        playSong((currentIndex + 1) % songs.length);
      }
    }

    function switchMode() {
      mode = (mode === "loop") ? "random" : "loop";
      document.getElementById("mode").textContent =
        mode === "loop" ? "🔁 循环播放" : "🔀 随机播放";
    }

    // 自动播放下一首
    audio.onended = nextSong;

    // 初始化
    renderPlaylist();
    playSong(0);
  </script>
</body>
</html>
